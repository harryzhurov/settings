#!/bin/bash
set -o pipefail

PACKAGE=openocd
SRC_DIR=${PWD}/sources
BUILD_DIR=${PWD}/build

CONFIGURE_OPTIONS=
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --prefix=/opt/cad/openocd"
#CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-maintainer-mode"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --disable-doxygen-html"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-ftdi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-jlink=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-stlink=yes"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-ti-icdi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-ulink=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-usb-blaster-2=yes"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-vsllink=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-osbdm=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-opendous=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-aice=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-usbprog=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-rlink=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-armjtagew=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-cmsis-dap=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-parport=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --disable-parport-ppdev"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-parport-giveio=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-legacy-ft2232_libftdi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-legacy-ft2232_ftd2xx=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-jtag_vpi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-usb_blaster_libftdi=yes"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-usb_blaster_ftd2xx=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-amtjtagaccel=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-zy1000-master=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-zy1000=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-ioutil=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-ep93xx=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-at91rm9200=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-bcm2835gpio=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-gw16012=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-presto_libftdi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-presto_ftd2xx=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-openjtag_ftd2xx=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-openjtag_ftdi=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-oocd_trace=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-buspirate=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-sysfsgpio=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-minidriver-dummy=no"
CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --enable-remote-bitbang=no"


mkdir -p $BUILD_DIR && cd $BUILD_DIR

$SRC_DIR/configure $CONFIGURE_OPTIONS | tee ../$PACKAGE.config.log && \
make -j8 2>&1 | tee ../$PACKAGE.build.log #&& \
make install 2>&1 | tee ../$PACKAGE.install.log
echo "done"